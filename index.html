<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Health Predictor</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <style>
        /* BASE STYLES FROM FRAUD DASHBOARD (Dark, Glass, Futuristic) */
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700;800&display=swap');
        :root{
            --bg-1: #0b1020;
            --bg-2: #0f1724;
            --glass-bg: rgba(255,255,255,0.08);
            --accent-blue: #06b6d4;
            --accent-purple: #7c3aed;
            --neon-green: #34d399;
            --primary-action: #10b981; /* Green for key actions */
        }
        html,body{height:100%;font-family:Inter,system-ui,Segoe UI,Roboto,'Helvetica Neue',Arial;}
        body{
            /* BACKGROUND: Dark blue/purple gradient with subtle glow */
            background:
                radial-gradient(900px 600px at 10% 10%, rgba(124,58,237,0.18), rgba(3,7,18,0) 30%),
                radial-gradient(1000px 700px at 90% 90%, rgba(6,182,212,0.18), rgba(3,7,18,0) 30%),
                linear-gradient(120deg,var(--bg-2) 0%, var(--bg-1) 100%);
            color:#e6eef8;
            -webkit-font-smoothing:antialiased;
            -moz-osx-font-smoothing:grayscale;
            margin:0;
            min-height:100vh;
            display: flex;
            flex-direction: column;
        }

        /* GLASS CARD EFFECT */
        .glass-card {
            background-color: var(--glass-bg); 
            backdrop-filter: blur(20px); 
            -webkit-backdrop-filter: blur(20px);
            border-radius: 1.5rem; 
            border: 1px solid rgba(255, 255, 255, 0.15); 
            box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.3); 
            transition: all 0.3s ease-in-out;
            position: relative;
            z-index: 10;
        }

        /* INPUT/FORM STYLING */
        .input-glow-focus:focus {
            outline: none;
            border-color: transparent;
            box-shadow: 0 0 0 2px var(--primary-action), 0 0 5px var(--primary-action);
            background-color: rgba(255, 255, 255, 0.15) !important;
            color: #f8fafc !important;
        }
        .input-glow-focus, select, input[type="number"], input[type="file"] {
            background-color: rgba(255, 255, 255, 0.1) !important;
            color: #f8fafc !important;
            border: 1px solid rgba(255, 255, 255, 0.2);
            padding: 10px;
            border-radius: 8px;
        }
        
        /* BUTTON STYLING */
        .btn-primary {
            background-color: var(--primary-action); 
            color: var(--bg-1);
            font-weight: 700;
            padding: 12px 24px;
            border-radius: 8px;
            transition: background-color 0.2s;
            box-shadow: 0 4px 10px rgba(52, 211, 163, 0.3);
        }
        .btn-secondary {
            background-color: #4a5568; 
            color: white;
            font-weight: medium;
            border-radius: 0.5rem;
            padding: 0.75rem 1.5rem;
            transition: all 0.15s ease-in-out;
        }
        .btn-card-action {
            background-color: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            color: #f8fafc;
        }
        .btn-card-action:hover {
            background-color: rgba(255, 255, 255, 0.15);
        }

        /* UTILITY COLORS (Ensuring consistency) */
        .text-blue-400 { color: var(--accent-blue); }
        .text-red-400 { color: #f87171; }
        .text-green-400 { color: var(--neon-green); }
        .text-purple-400 { color: var(--accent-purple); }
        .text-gray-300 { color: #cbd5e1; }
        .text-gray-400 { color: #a0aec0; }
        .text-gray-50 { color: #f8fafc; }

        /* FRAME LAYOUT */
        .app-frame {
            max-width: 800px; 
            margin: 2rem auto;
            min-height: 85vh;
            padding: 2rem;
        }
        
        /* GAUGE/RESULT STYLING */
        .prediction-gauge {
            width: 150px;
            height: 150px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            background: var(--color-risk); /* Base color for the arc */
            background-image: conic-gradient(
                var(--color-risk) calc(var(--prob-percent) * 0.999), /* Solid color up to percentage */
                rgba(255, 255, 255, 0.2) calc(var(--prob-percent) * 0.999) /* Transparent rest */
            );
        }
        .prediction-gauge::before {
            content: '';
            position: absolute;
            width: 80%;
            height: 80%;
            background: var(--glass-bg); /* Use glass background for inner circle */
            border-radius: 50%;
            z-index: 1;
        }
        .gauge-text {
            z-index: 2;
            text-align: center;
        }

        /* MOCK CHART STYLING */
        .chart-container {
            height: 256px;
            border-radius: 8px;
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 10px;
            margin-top: 10px;
            background-color: rgba(0, 0, 0, 0.15);
        }
        .mock-pie {
            width: 150px;
            height: 150px;
            border-radius: 50%;
            background: conic-gradient(
                #10b981 0% 40%,        
                #ef4444 40% 75%,        
                #a78bfa 75% 100%       
            );
            box-shadow: 0 0 15px rgba(52, 211, 163, 0.4); 
        }
        .mock-bar-chart {
            display: flex;
            align-items: flex-end;
            justify-content: space-around;
            width: 100%;
            height: 90%;
            border-left: 1px solid rgba(255, 255, 255, 0.1);
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            padding: 0 10px;
        }
        .bar-wrapper {
            display: flex;
            flex-direction: column;
            align-items: center;
            height: 100%;
            justify-content: flex-end;
            width: 18%;
        }
        .bar {
            width: 80%;
            transition: height 0.5s;
            position: relative;
            border-radius: 4px 4px 0 0;
            background-color: var(--primary-action); 
            box-shadow: 0 0 8px rgba(52, 211, 163, 0.6);
        }
        .bar-label {
            position: absolute;
            top: -15px;
            font-size: 10px;
            color: #f8fafc;
        }
        .bar-group-label {
            margin-top: 5px;
            font-size: 11px;
            color: #a0aec0;
        }
    </style>
</head>
<body class="p-4 sm:p-8">
    
    <!-- The main glass card frame wraps everything --><div id="app" class="app-frame glass-card">
        
        <!-- Header & Title --><header class="mb-8 flex items-center justify-between border-b border-gray-700 pb-4">
            <div class="flex items-center space-x-3">
                <!-- HOME BUTTON (Now light icon) --><button onclick="setActiveView('home')" class="p-2 rounded-full hover:bg-white/10 transition text-gray-300">
                    <!-- Home Icon --><svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"></path></svg>
                </button>
                
                <!-- Logo: Caduceus Medical Icon (White/Green accent) --><svg class="w-10 h-10 text-green-400" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 18h.01M8.28 14.53l-3.53 3.53M15.72 14.53l3.53 3.53M12 3v15M12 3c1.66 0 3 .895 3 2s-1.34 2-3 2-3-.895-3-2 1.34-2 3-2z"></path></svg>

                <h1 id="main-app-title" class="text-2xl font-bold text-gray-50 tracking-wider hidden sm:block">Disease Detector</h1>
            </div>
        </header>

        <!-- Main Content Area --><main class="space-y-8">

            <!-- 0. Home View (Landing Page) --><div id="home-view" class="view-content flex flex-col items-center justify-center text-center p-4 min-h-[60vh]">
                <!-- Replicating text from your frame image --><h3 class="text-xl text-gray-400 font-medium mb-2">Welcome to</h3>
                <h1 class="text-5xl font-extrabold text-gray-50 tracking-tight mb-4 leading-tight">
                    Disease Detecting using AI/ML
                </h1>
                
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6 w-full max-w-xl my-10">
                    
                    <!-- Diabetes --><div onclick="setActiveView('diabetes')" class="p-4 btn-card-action hover:bg-white/15 transition duration-300 rounded-xl shadow-lg cursor-pointer">
                        <svg class="w-8 h-8 text-green-400 mb-2 mx-auto" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 22s-8-4-8-10V5l8-3 8 3v7c0 6-8 10-8 10zM12 11V3"></path><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 18a6 6 0 100-12 6 6 0 000 12z"></path></svg>
                        <span class="text-lg font-semibold text-gray-50 block">Diabetes Prediction</span>
                        <span class="text-xs text-gray-400 block">Blood Sugar Analysis</span>
                    </div>

                    <!-- Heart Disease --><div onclick="setActiveView('heart')" class="p-4 btn-card-action hover:bg-white/15 transition duration-300 rounded-xl shadow-lg cursor-pointer">
                        <svg class="w-8 h-8 text-red-400 mb-2 mx-auto" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.84 4.61a5.5 5.5 0 00-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 00-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 000-7.78z"></path></svg>
                        <span class="text-lg font-semibold text-gray-50 block">Heart Disease Prediction</span>
                        <span class="text-xs text-gray-400 block">ECG & Clinical Data</span>
                    </div>
                    
                    <!-- View History (Adapted from Parkinson's or Peak) --><div onclick="setActiveView('peak-analysis')" class="p-4 btn-card-action hover:bg-white/15 transition duration-300 rounded-xl shadow-lg cursor-pointer">
                        <svg class="w-8 h-8 text-purple-400 mb-2 mx-auto" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6V4m0 16v-2m-3-4h6m-6-4h6m-6-4h6m-2-4H7a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2z"></path></svg>
                        <span class="text-lg font-semibold text-gray-50 block">View Analysis Reports</span>
                        <span class="text-xs text-gray-400 block">Peak Risk & History</span>
                    </div>
                </div>

                <!-- Get Started Button (Adapted for the new frame flow) --><button onclick="uploadDatasetUI()" class="mt-8 px-10 py-3 btn-primary">
                    Bulk Data Processing
                </button>

                <p class="mt-8 text-sm text-gray-400">Empowering health through intelligent insights</p>
            </div>
            
            <!-- 0.5. Dataset Upload View --><div id="dataset-upload-view" class="view-content hidden">
                <div class="space-y-6">
                    <h2 class="text-2xl font-semibold border-b border-gray-700 pb-4 text-gray-50">Bulk Dataset Upload for Predictive Analysis</h2>
                    <p class="text-gray-300">Upload a CSV dataset for batch prediction and population-level analysis.</p>

                    <div class="space-y-4">
                        <label for="bulk-file" class="block text-sm font-medium text-gray-200">Select CSV Dataset (.csv)</label>
                        <input type="file" id="bulk-file" accept=".csv" class="w-full text-gray-50 bg-white/10 border border-gray-600 rounded-lg p-3 file:mr-4 file:py-2 file:px-4 file:rounded-lg file:border-0 file:text-sm file:font-semibold file:bg-blue-500 file:text-white hover:file:bg-blue-600 transition duration-150 input-glow-focus">
                        
                        <label for="dataset-type" class="block text-sm font-medium text-gray-200">Select Dataset Type</label>
                        <select id="dataset-type" class="w-full bg-white/10 border border-gray-600 rounded-lg p-3 text-gray-50 input-glow-focus">
                            <option value="diabetes">Diabetes (PIMA)</option>
                            <option value="heart">Heart Disease (Cleveland)</option>
                            <option value="parkinsons">Parkinson's (Speech Analysis)</option>
                        </select>
                        
                        <!-- REMOVED: Database Selection, as requested -->
                        <!-- <label for="database-option" class="block text-sm font-medium text-gray-200">Select Database for Storage</label>
                        <select id="database-option" class="w-full bg-white/10 border border-gray-600 rounded-lg p-3 text-gray-50 input-glow-focus">
                            <option value="firestore">Firestore (Real-time Cloud Database)</option>
                            <option value="mongodb">MongoDB (NoSQL Document Database)</option>
                        </select> -->

                        <button onclick="handleBulkUpload()" class="w-full md:w-auto px-8 py-3 btn-primary text-white bg-indigo-600 hover:bg-indigo-700 transition duration-150 mt-4 shadow-lg shadow-indigo-300/50">
                            Run Bulk Prediction & Analysis
                        </button>
                    </div>
                    
                    <div id="bulk-status" class="pt-4 text-sm text-gray-400"></div>
                    
                    <button onclick="setActiveView('home')" class="mt-6 px-6 py-2 btn-secondary">
                        Back to Home
                    </button>
                </div>
            </div>

            <!-- 1. Diabetes Prediction View --><div id="diabetes-view" class="view-content hidden">
                <div class="space-y-6">
                    <h2 class="text-2xl font-semibold border-b border-gray-700 pb-4 text-green-400">1. Diabetes Risk Prediction (PIMA Dataset Features)</h2>
                    <form id="diabetes-form" onsubmit="event.preventDefault(); predict('diabetes');" class="space-y-4">
                        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                            
                            <label class="block">
                                <span class="text-gray-300">1. Pregnancies (0-17)</span>
                                <input type="number" name="Pregnancies" min="0" max="17" value="3" class="w-full bg-white/10 border border-gray-600 rounded-lg p-3 text-gray-50 input-glow-focus" required>
                            </label>

                            <label class="block">
                                <span class="text-gray-300">2. Glucose (Plasma Glucose Concentration)</span>
                                <input type="number" name="Glucose" min="0" value="120" class="w-full bg-white/10 border border-gray-600 rounded-lg p-3 text-gray-50 input-glow-focus" required>
                            </label>

                            <label class="block">
                                <span class="text-gray-300">3. Blood Pressure (Diastolic BP)</span>
                                <input type="number" name="BloodPressure" min="0" value="70" class="w-full bg-white/10 border border-gray-600 rounded-lg p-3 text-gray-50 input-glow-focus" required>
                            </label>

                            <label class="block">
                                <span class="text-gray-300">4. Skin Thickness (Triceps skin fold thickness)</span>
                                <input type="number" name="SkinThickness" min="0" value="30" class="w-full bg-white/10 border border-gray-600 rounded-lg p-3 text-gray-50 input-glow-focus" required>
                            </label>
                            
                            <label class="block">
                                <span class="text-gray-300">5. Insulin (2-Hour serum insulin)</span>
                                <input type="number" name="Insulin" min="0" value="150" class="w-full bg-white/10 border border-gray-600 rounded-lg p-3 text-gray-50 input-glow-focus" required>
                            </label>

                            <label class="block">
                                <span class="text-gray-300">6. BMI (Body mass index)</span>
                                <input type="number" name="BMI" step="0.1" min="0" value="32.5" class="w-full bg-white/10 border border-gray-600 rounded-lg p-3 text-gray-50 input-glow-focus" required>
                            </label>
                            
                            <label class="block">
                                <span class="text-gray-300">7. Diabetes Pedigree Function</span>
                                <input type="number" name="DiabetesPedigreeFunction" step="0.001" min="0" value="0.5" class="w-full bg-white/10 border border-gray-600 rounded-lg p-3 text-gray-50 input-glow-focus" required>
                            </label>

                            <label class="block">
                                <span class="text-gray-300">8. Age (years)</span>
                                <input type="number" name="Age" min="20" value="35" class="w-full bg-white/10 border border-gray-600 rounded-lg p-3 text-gray-50 input-glow-focus" required>
                            </label>
                            
                        </div>
                        <button type="submit" id="diabetes-btn" class="w-full md:w-auto px-8 py-3 btn-primary mt-6">
                            Predict Diabetes Risk
                        </button>
                    </form>

                    <div id="diabetes-result" class="hidden pt-6">
                        <!-- Result will be displayed here --></div>
                </div>
            </div>

            <!-- 2. Heart Disease Prediction View --><div id="heart-view" class="view-content hidden">
                <div class="space-y-6">
                    <h2 class="text-2xl font-semibold border-b border-gray-700 pb-4 text-red-400">2. Heart Disease Risk Prediction (Cleveland Dataset Features)</h2>
                    <form id="heart-form" onsubmit="event.preventDefault(); predict('heart');" class="space-y-4">
                        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                            
                            <label class="block">
                                <span class="text-gray-300">1. Age (years)</span>
                                <input type="number" name="age" min="29" max="77" value="55" class="w-full bg-white/10 border border-gray-600 rounded-lg p-3 text-gray-50 input-glow-focus" required>
                            </label>

                            <label class="block">
                                <span class="text-gray-300">2. Sex (1=Male, 0=Female)</span>
                                <select name="sex" class="w-full bg-white/10 border border-gray-600 rounded-lg p-3 text-gray-50 input-glow-focus">
                                    <option value="1">Male</option>
                                    <option value="0">Female</option>
                                </select>
                            </label>

                            <label class="block">
                                <span class="text-gray-300">3. CP (Chest Pain Type: 0-3)</span>
                                <select name="cp" class="w-full bg-white/10 border border-gray-600 rounded-lg p-3 text-gray-50 input-glow-focus">
                                    <option value="0">0: Typical Angina</option>
                                    <option value="1">1: Atypical Angina</option>
                                    <option value="2">2: Non-Anginal Pain</option>
                                    <option value="3">3: Asymptomatic</option>
                                </select>
                            </label>

                            <label class="block">
                                <span class="text-gray-300">4. TrestBPS (Resting Blood Pressure)</span>
                                <input type="number" name="trestbps" min="94" max="200" value="130" class="w-full bg-white/10 border border-gray-600 rounded-lg p-3 text-gray-50 input-glow-focus" required>
                            </label>
                            
                            <label class="block">
                                <span class="text-gray-300">5. Chol (Serum Cholestoral)</span>
                                <input type="number" name="chol" min="126" max="564" value="240" class="w-full bg-white/10 border border-gray-600 rounded-lg p-3 text-gray-50 input-glow-focus" required>
                            </label>

                            <label class="block">
                                <span class="text-gray-300">6. FBS (>120 mg/dl: 1=True, 0=False)</span>
                                <select name="fbs" class="w-full bg-white/10 border border-gray-600 rounded-lg p-3 text-gray-50 input-glow-focus">
                                    <option value="0">0 (False)</option>
                                    <option value="1">1 (True)</option>
                                </select>
                            </label>
                            
                            <label class="block">
                                <span class="text-gray-300">7. RestECG (Resting Electrocardiographic Results)</span>
                                <select name="restecg" class="w-full bg-white/10 border border-gray-600 rounded-lg p-3 text-gray-50 input-glow-focus">
                                    <option value="0">0: Normal</option>
                                    <option value="1">1: ST-T wave abnormality</option>
                                    <option value="2">2: Left ventricular hypertrophy</option>
                                </select>
                            </label>

                            <label class="block">
                                <span class="text-gray-300">8. Thalach (Max Heart Rate achieved)</span>
                                <input type="number" name="thalach" min="71" max="202" value="150" class="w-full bg-white/10 border border-gray-600 rounded-lg p-3 text-gray-50 input-glow-focus" required>
                            </label>
                            
                            <label class="block">
                                <span class="text-gray-300">9. Exang (Exercise induced angina: 1=Yes, 0=No)</span>
                                <select name="exang" class="w-full bg-white/10 border border-gray-600 rounded-lg p-3 text-gray-50 input-glow-focus">
                                    <option value="0">No</option>
                                    <option value="1">Yes</option>
                                </select>
                            </label>

                             <label class="block">
                                <span class="text-gray-300">10. Oldpeak (ST depression induced by exercise)</span>
                                <input type="number" name="oldpeak" step="0.1" min="0" value="1.0" class="w-full bg-white/10 border border-gray-600 rounded-lg p-3 text-gray-50 input-glow-focus" required>
                            </label>

                             <label class="block">
                                <span class="text-gray-300">11. Slope (Slope of the peak exercise ST segment)</span>
                                <select name="slope" class="w-full bg-white/10 border border-gray-600 rounded-lg p-3 text-gray-50 input-glow-focus">
                                    <option value="0">0</option>
                                    <option value="1">1</option>
                                    <option value="2">2</option>
                                </select>
                            </label>
                            
                             <label class="block">
                                <span class="text-gray-300">12. CA (Number of major vessels (0-3) colored by flourosopy)</span>
                                <select name="ca" class="w-full bg-white/10 border border-gray-600 rounded-lg p-3 text-gray-50 input-glow-focus">
                                    <option value="0">0</option>
                                    <option value="1">1</option>
                                    <option value="2">2</option>
                                    <option value="3">3</option>
                                </select>
                            </label>

                             <label class="block">
                                <span class="text-gray-300">13. Thal (Thalassemia: 1-3)</span>
                                <select name="thal" class="w-full bg-white/10 border border-gray-600 rounded-lg p-3 text-gray-50 input-glow-focus">
                                    <option value="1">1: Normal</option>
                                    <option value="2">2: Fixed defect</option>
                                    <option value="3">3: Reversible defect</option>
                                </select>
                            </label>

                        </div>
                        <button type="submit" id="heart-btn" class="w-full md:w-auto px-8 py-3 btn-primary mt-6">
                            Predict Heart Disease Risk
                        </button>
                    </form>

                    <div id="heart-result" class="hidden pt-6">
                        <!-- Result will be displayed here --></div>
                </div>
            </div>
            
            <!-- 3. Parkinson's Prediction View --><div id="parkinsons-view" class="view-content hidden">
                <div class="space-y-6">
                    <h2 class="text-2xl font-semibold border-b border-gray-700 pb-4 text-green-400">3. Parkinson's Risk Prediction (Voice/Speech Features)</h2>
                    <p class="text-gray-300">Input values typically derived from vocal recording analysis (sustained 'a' sound) to detect subtle tremors and voice degradation.</p>
                    <form id="parkinsons-form" onsubmit="event.preventDefault(); predict('parkinsons');" class="space-y-4">
                        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                            
                            <label class="block">
                                <span class="text-gray-300">1. Fo(Hz) - Average vocal fundamental frequency</span>
                                <input type="number" name="MDVP:Fo(Hz)" step="0.01" min="0" value="150.0" class="w-full bg-white/10 border border-gray-600 rounded-lg p-3 text-gray-50 input-glow-focus" required>
                            </label>

                            <label class="block">
                                <span class="text-gray-300">2. Jitter (%) - Variation in period of vocal fold vibration</span>
                                <input type="number" name="MDVP:Jitter(%)" step="0.0001" min="0" value="0.005" class="w-full bg-white/10 border border-gray-600 rounded-lg p-3 text-gray-50 input-glow-focus" required>
                            </label>

                            <label class="block">
                                <span class="text-gray-300">3. Shimmer (dB) - Variation in amplitude of vocal fold vibration</span>
                                <input type="number" name="MDVP:Shimmer(dB)" step="0.001" min="0" value="0.03" class="w-full bg-white/10 border border-gray-600 rounded-lg p-3 text-gray-50 input-glow-focus" required>
                            </label>

                            <label class="block">
                                <span class="text-gray-300">4. NHR (Noise to Harmonic Ratio)</span>
                                <input type="number" name="NHR" step="0.001" min="0" value="0.02" class="w-full bg-white/10 border border-gray-600 rounded-lg p-3 text-gray-50 input-glow-focus" required>
                            </label>
                            
                            <label class="block">
                                <span class="text-gray-300">5. HNR (Harmonic to Noise Ratio)</span>
                                <input type="number" name="HNR" step="0.1" min="0" value="25.0" class="w-full bg-white/10 border border-gray-600 rounded-lg p-3 text-gray-50 input-glow-focus" required>
                            </label>

                            <label class="block">
                                <span class="text-gray-300">6. RPDE (Recurrence Period Density Entropy)</span>
                                <input type="number" name="RPDE" step="0.001" min="0" value="0.5" class="w-full bg-white/10 border border-gray-600 rounded-lg p-3 text-gray-50 input-glow-focus" required>
                            </label>
                            
                             <label class="block">
                                <span class="text-gray-300">7. DFA (Detrended Fluctuation Analysis)</span>
                                <input type="number" name="DFA" step="0.001" min="0" value="0.6" class="w-full bg-white/10 border border-gray-600 rounded-lg p-3 text-gray-50 input-glow-focus" required>
                            </label>

                            <label class="block">
                                <span class="text-gray-300">8. PPE (Pitch Perturbation Entropy)</span>
                                <input type="number" name="PPE" step="0.001" min="0" value="0.2" class="w-full bg-white/10 border border-gray-600 rounded-lg p-3 text-gray-50 input-glow-focus" required>
                            </label>
                            
                        </div>
                        <button type="submit" id="parkinsons-btn" class="w-full md:w-auto px-8 py-3 btn-primary mt-6">
                            Predict Parkinson's Risk
                        </button>
                    </form>

                    <div id="parkinsons-result" class="hidden pt-6">
                        <!-- Result will be displayed here --></div>
                </div>
            </div>
            
            <!-- 4. Peak Demographic Analysis View --><div id="peak-analysis-view" class="view-content hidden">
                <div class="space-y-8">
                    <h2 class="text-2xl font-semibold border-b border-gray-700 pb-4 text-purple-400">Peak Demographic Analysis & Reporting</h2>
                    <p class="text-gray-300">Detailed insights into which demographic groups and lifestyle factors are driving the highest prediction risks across all models.</p>

                    <!-- Mock Charts and Visualizations --><div class="grid lg:grid-cols-2 gap-6">
                        
                        <!-- Pie Chart: Overall Disease Distribution --><div class="bg-white/10 border border-gray-600 p-5 rounded-lg">
                            <h3 class="text-xl font-medium mb-3 text-purple-300">Overall Positive Prediction Distribution</h3>
                            <div class="chart-container flex items-center justify-center">
                                <div class="mock-pie"></div>
                                <div class="absolute right-6 top-1/2 transform -translate-y-1/2 text-xs space-y-2 text-gray-300">
                                    <p><span class="inline-block w-2 h-2 rounded-full bg-green-400 mr-1"></span> Diabetes (40%)</p>
                                    <p><span class="inline-block w-2 h-2 rounded-full bg-red-400 mr-1"></span> Heart (35%)</p>
                                    <p><span class="inline-block w-2 h-2 rounded-full bg-purple-400 mr-1"></span> Parkinson's (25%)</p>
                                </div>
                            </div>
                            <p class="text-xs text-gray-400 mt-2">Analysis: Heart and Diabetes risks currently dominate the population dataset.</p>
                        </div>
                        
                        <!-- Bar Chart: Risk by Age Group --><div class="bg-white/10 border border-gray-600 p-5 rounded-lg">
                            <h3 class="text-xl font-medium mb-3 text-purple-300">Highest Risk Prediction by Age Group</h3>
                            <div class="chart-container">
                                <div class="mock-bar-chart">
                                    <div class="bar-wrapper">
                                        <div class="bar" style="height: 50%;">
                                            <div class="bar-label">50%</div>
                                        </div>
                                        <div class="bar-group-label">30s</div>
                                    </div>
                                    <div class="bar-wrapper">
                                        <div class="bar" style="height: 75%;">
                                            <div class="bar-label">75%</div>
                                        </div>
                                        <div class="bar-group-label">40s</div>
                                    </div>
                                    <div class="bar-wrapper">
                                        <div class="bar" style="height: 100%; background-color: #ef4444; box-shadow: 0 -2px 8px rgba(239, 68, 68, 0.6);">
                                            <div class="bar-label">100%</div>
                                        </div>
                                        <div class="bar-group-label">50s</div>
                                    </div>
                                    <div class="bar-wrapper">
                                        <div class="bar" style="height: 85%;">
                                            <div class="bar-label">85%</div>
                                        </div>
                                        <div class="bar-group-label">60+</div>
                                    </div>
                                </div>
                            </div>
                            <p class="text-xs text-gray-400 mt-2">Analysis: The 50s group exhibits the highest combined risk across Heart and Diabetes models.</p>
                        </div>
                    </div>
                    
                    <!-- Demographic Breakdown Table --><div class="mt-6">
                        <h3 class="text-xl font-medium mb-4 border-b border-gray-700 pb-2 text-purple-300">Disease Risk Breakdown by Key Factor (Table)</h3>
                        <div class="overflow-x-auto">
                            <table class="min-w-full divide-y divide-gray-700 text-sm bg-white/10 rounded-lg">
                                <thead>
                                    <tr>
                                        <th class="px-4 py-2 text-left text-xs font-medium text-gray-400 uppercase tracking-wider">Demographic/Factor</th>
                                        <th class="px-4 py-2 text-left text-xs font-medium text-gray-400 uppercase tracking-wider">Diabetes High Risk (%)</th>
                                        <th class="px-4 py-2 text-left text-xs font-medium text-gray-400 uppercase tracking-wider">Heart High Risk (%)</th>
                                        <th class="px-4 py-2 text-left text-xs font-medium text-gray-400 uppercase tracking-wider">Reason for Peak</th>
                                    </tr>
                                </thead>
                                <tbody class="divide-y divide-gray-700 text-gray-50">
                                    <tr class="hover:bg-gray-800 transition">
                                        <td>BMI > 30 (Obese)</td>
                                        <td class="text-red-400">55.2%</td>
                                        <td>31.0%</td>
                                        <td>Direct causation in PIMA dataset, high Chol/BP correlation.</td>
                                    </tr>
                                    <tr class="hover:bg-gray-800 transition">
                                        <td>Age 60+</td>
                                        <td>32.0%</td>
                                        <td class="text-red-400">68.7%</td>
                                        <td>Natural decline in cardiac health (Thalach, TrestBPS) and extended exposure time.</td>
                                    </tr>
                                    <tr class="hover:bg-gray-800 transition">
                                        <td>High Jitter/Shimmer (Parkinson's)</td>
                                        <td>1.5%</td>
                                        <td>5.0%</td>
                                        <td>Specific neurological pattern, not strongly correlated with metabolic disease.</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                    
                    <button onclick="setActiveView('home')" class="mt-6 px-6 py-2 btn-secondary">
                        Back to Home
                    </button>
                </div>
            </div>

        </main>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, signInWithCustomToken } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, doc, addDoc, collection } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // --- GLOBAL VARIABLES & FIREBASE SETUP ---
        let db;
        let auth;
        let userId = 'anonymous'; 
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';

        async function initFirebase() {
            try {
                const firebaseConfig = JSON.parse(typeof __firebase_config !== 'undefined' ? __firebase_config : '{}');
                if (Object.keys(firebaseConfig).length === 0) {
                    console.error("Firebase config is missing.");
                    // Provide a mock Firebase for development if config is missing
                    db = {
                        collection: () => ({
                            addDoc: async (data) => console.log("MOCK Firestore: Logging data (no config):", data)
                        })
                    };
                    auth = {
                        currentUser: { uid: 'mock-anonymous' }
                    };
                    userId = 'mock-anonymous';
                    console.log("MOCK Firebase initialized. User ID:", userId);
                    return;
                }
                
                const app = initializeApp(firebaseConfig);
                db = getFirestore(app);
                auth = getAuth(app);

                const initialAuthToken = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null;
                
                if (initialAuthToken) {
                    await signInWithCustomToken(auth, initialAuthToken);
                } else {
                    await signInAnonymously(auth);
                }
                
                userId = auth.currentUser ? auth.currentUser.uid : 'anonymous';
                console.log("Firebase initialized. User ID:", userId);

            } catch (error) {
                console.error("Error during Firebase initialization or sign-in:", error);
            }
        }
        
        // --- FIRESTORE UTILITIES ---
        class FirestoreDB {
            static async insertPrediction(data) {
                if (!db || !userId) return console.error("Firestore not initialized.");
                try {
                    // Private collection path: /artifacts/{appId}/users/{userId}/prediction_history
                    const collectionPath = `artifacts/${appId}/users/${userId}/prediction_history`;
                    await addDoc(collection(db, collectionPath), data);
                    console.log("Firestore: Individual Prediction logged successfully.");
                    return { success: true };
                } catch (e) {
                    console.error("Error logging prediction to Firestore:", e);
                    return { success: false, error: e };
                }
            }
            
            static async logBulkUpload(filename, type, count) {
                if (!db || !userId) return console.error("Firestore not initialized.");
                try {
                    // Private collection path: /artifacts/{appId}/users/{userId}/bulk_uploads
                    const collectionPath = `artifacts/${appId}/users/${userId}/bulk_uploads`;
                    await addDoc(collection(db, collectionPath), {
                        filename: filename,
                        datasetType: type,
                        recordCount: count,
                        uploadTime: new Date().toISOString(),
                        status: 'Processed',
                        database: 'firestore' // Indicate database used
                    });
                    console.log(`Firestore: Bulk upload metadata logged successfully for ${filename}.`);
                    return { success: true };
                } catch (e) {
                    console.error("Error logging bulk upload metadata to Firestore:", e);
                    return { success: false, error: e };
                }
            }
        }

        // --- MOCK MONGODB UTILITIES (Frontend Only) ---
        class MongoDBService {
            static async logBulkUpload(filename, type, count) {
                // In a real application, this would make an API call to your backend Flask server
                // which then interacts with MongoDB.
                console.log(`MOCK MongoDB: Simulating bulk upload log for ${filename}, type: ${type}, records: ${count}`);
                
                // Simulate an API call delay
                await new Promise(resolve => setTimeout(resolve, 800));

                // Mock success for frontend demonstration
                return { success: true }; 
            }
            // Add other MongoDB related functions (e.g., retrieving data) here,
            // always assuming they interact with a backend API.
        }


        // --- CORE UI/NAVIGATION FUNCTIONS ---

        function setActiveView(viewId) {
            document.querySelectorAll('.view-content').forEach(view => view.classList.add('hidden'));
            
            // Show the main page content
            document.getElementById(`${viewId}-view`).classList.remove('hidden');

            // Hide all individual prediction results when switching views
            document.getElementById('diabetes-result')?.classList.add('hidden');
            document.getElementById('heart-result')?.classList.add('hidden');
            document.getElementById('parkinsons-result')?.classList.add('hidden');
        }

        // Handles the "Bulk Upload & Analysis" Button Logic
        function uploadDatasetUI() {
            setActiveView('dataset-upload');
            document.getElementById('bulk-status').innerHTML = ''; // Clear previous status
        }
        
        // Simulates the upload and Firestore storage process
        async function handleBulkUpload() {
            const fileInput = document.getElementById('bulk-file');
            const datasetType = document.getElementById('dataset-type').value;
            // REMOVED: const databaseOption = document.getElementById('database-option').value;
            const statusDiv = document.getElementById('bulk-status');

            if (!fileInput.files.length) {
                statusDiv.innerHTML = '<p class="text-red-400">Please select a CSV file to upload.</p>';
                return;
            }

            const fileName = fileInput.files[0].name;
            const mockRecordCount = Math.floor(Math.random() * 500) + 1000; // Mock record count
            const databaseOption = 'Firestore'; // Default/assumed database for logging

            statusDiv.innerHTML = `<p class="text-blue-400">Processing ${fileName} for ${datasetType} model... (Logging metadata)</p>`;

            // --- Simplified Logic: Only logs to Firestore for mock purposes ---
            const dbResult = await FirestoreDB.logBulkUpload(fileName, datasetType, mockRecordCount);

            // --- Mock Analysis & Navigation (Direct Output) ---
            await new Promise(resolve => setTimeout(resolve, 1500)); // Simulate analysis time

            if (dbResult.success) {
                 statusDiv.innerHTML = `
                    <p class="text-green-400 font-bold">✅ Bulk Prediction Complete!</p>
                    <p class="text-gray-300">Analysis run successfully on ${mockRecordCount} records. Navigating to Peak Analysis...</p>
                 `;
                // Direct navigation to the Peak Analysis page
                setActiveView('peak-analysis');
            } else {
                 statusDiv.innerHTML = `<p class="text-red-400">❌ Error logging metadata: Analysis aborted.</p>`;
            }
        }

        // Helper function to convert form data to JSON object
        function formToJSON(formId) {
            const form = document.getElementById(formId);
            const data = new FormData(form);
            const json = {};
            data.forEach((value, key) => {
                const numValue = parseFloat(value);
                json[key] = isNaN(numValue) ? value : numValue;
            });
            return json;
        }

        // Function to determine risk based on probability
        function getRiskLevel(prob, type) {
            let risk = { level: 'LOW', color: '#34d399', message: 'The AI model suggests a low risk of disease based on the provided inputs.' }; // Green (LOW)

            if (prob >= 0.75) {
                risk.level = 'HIGH';
                let highColor = '#ef4444'; 
                if (type === 'heart') highColor = '#f97316'; 
                if (type === 'parkinsons') highColor = '#a78bfa'; /* Lighter purple for dark mode */
                
                risk.color = highColor; 
                risk.message = 'The model predicts a high probability. It is strongly recommended to consult a specialist.';
            } else if (prob >= 0.50) {
                risk.level = 'MEDIUM';
                risk.color = '#fbbf24'; // Yellow (MEDIUM)
                risk.message = 'The risk score is moderate. Further monitoring and professional advice may be needed.';
            }
            return risk;
        }

        // Main prediction function (MOCKING THE FLASK BACKEND CALL)
        async function predict(type) {
            const formId = `${type}-form`;
            const buttonId = `${type}-btn`;
            const btn = document.getElementById(buttonId);
            
            const inputData = formToJSON(formId);

            // Simulate loading state
            const originalText = btn.textContent;
            btn.textContent = 'Analyzing...';
            btn.disabled = true;

            // --- MOCK API CALL SIMULATION ---
            await new Promise(resolve => setTimeout(resolve, 1800)); // Simulate network latency
            
            let mockOutcome;
            if (type === 'parkinsons') {
                mockOutcome = Math.random() > 0.7 ? 1 : 0; 
            } else {
                mockOutcome = Math.random() > 0.6 ? 1 : 0;
            }
            
            let mockProbability = mockOutcome === 1 ? (0.6 + Math.random() * 0.4).toFixed(3) : (0.2 + Math.random() * 0.4).toFixed(3);
            
            const predictionResult = {
                prediction: mockOutcome === 1 ? "Positive" : "Negative",
                probability: parseFloat(mockProbability)
            };

            // STEP 7: History Logging to Firestore (still assuming Firestore for individual predictions for simplicity)
            const logData = {
                timestamp: new Date().toISOString(),
                disease: type,
                inputs: inputData,
                output: predictionResult,
                userId: userId, // Log the user ID
                database: 'firestore' // Individual predictions default to Firestore
            };
            await FirestoreDB.insertPrediction(logData);


            // Restore button state
            btn.textContent = originalText;
            btn.disabled = false;
            
            // Display results on UI
            displayResult(type, predictionResult);
        }

        function displayResult(type, data) {
            const resultDiv = document.getElementById(`${type}-result`);
            const prob = data.probability;
            const risk = getRiskLevel(prob, type);
            const probPercent = (prob * 100).toFixed(1) + '%';
            
            const gaugeStyle = `
                --prob-percent: ${probPercent};
                --color-risk: ${risk.color};
            `;
            
            let title = '';
            if (type === 'diabetes') title = 'Diabetes Risk Score';
            if (type === 'heart') title = 'Heart Disease Risk Score';
            if (type === 'parkinsons') title = "Parkinson's Risk Score";
            
            const riskIcon = risk.level === 'HIGH' ? '🚨' : risk.level === 'MEDIUM' ? '⚠️' : '✅';
            
            resultDiv.innerHTML = `
                <div class="bg-white/10 border border-gray-600 p-6 md:p-8 space-y-6 rounded-xl shadow-lg">
                    <h3 class="text-xl font-bold border-b border-gray-700 pb-3 text-gray-100">${title}</h3>
                    
                    <div class="md:flex items-center space-y-6 md:space-y-0 md:space-x-8">
                        
                        <!-- Probability Gauge (Pie Chart style) --><div style="${gaugeStyle}" class="prediction-gauge flex-shrink-0">
                            <div class="gauge-text text-gray-100">
                                <span class="block text-3xl font-extrabold">${probPercent}</span>
                                <span class="block text-sm text-gray-400">Probability</span>
                            </div>
                        </div>

                        <!-- Risk Meter & Message --><div class="flex-grow space-y-4">
                            <h4 class="text-3xl font-extrabold flex items-center space-x-3" style="color: ${risk.color};">
                                <span>${riskIcon} ${risk.level} RISK</span>
                            </h4>
                            <p class="text-gray-300">${risk.message}</p>
                            
                            <div class="mt-4">
                                <h5 class="text-lg font-semibold text-gray-200">Prediction Outcome:</h5>
                                <p class="text-2xl font-bold">${data.prediction} (${data.prediction === 'Positive' ? 'Needs Attention' : 'All Clear'})</p>
                            </div>
                        </div>
                    </div>
                    
                    <button onclick="setActiveView('home')" class="mt-6 px-6 py-2 btn-secondary">
                        Back to Home
                    </button>
                </div>
            `;
            resultDiv.classList.remove('hidden');
        }
        
        // --- EXPOSE FUNCTIONS GLOBALLY TO HTML ONCLICK ATTRIBUTES ---
        window.setActiveView = setActiveView;
        window.uploadDatasetUI = uploadDatasetUI;
        window.handleBulkUpload = handleBulkUpload;
        window.predict = predict;
        // -----------------------------------------------------------

        document.addEventListener('DOMContentLoaded', () => {
            initFirebase();
            setActiveView('home');
        });
    </script>

</body>
</html>